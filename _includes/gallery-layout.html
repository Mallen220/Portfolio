{% assign gallery_images = site.data.auto_galleries[include.picture_path] %} {%
assign sizes = "800,1600" | split: "," %}

<div class="gallery-container">
  {% if include.google_photos_album %}
  <div class="download-all">
    <a
      href="{{ include.google_photos_album }}"
      class="btn btn-download"
      target="_blank"
    >
      <i class="fa fa-download"></i> Download All Originals from Google Photos
    </a>
  </div>
  {% endif %}

  <div class="gallery-grid" id="gallery-{{ include.picture_path | slugify }}">
    {% for image in gallery_images %} {% assign base_name = image | split: '.' |
    first %} {% assign ext = image | split: '.' | last %}

    <div class="gallery-item">
      <a
        href="{{ site.url }}{{ site.baseurl }}/assets/img/gallery/{{ include.picture_path }}/{{ base_name }}-1600.{{ ext }}"
        class="gallery-link"
        data-download-url="{{ site.url }}{{ site.baseurl }}/assets/img/gallery/{{ include.picture_path }}/{{ image }}"
        data-sub-html="<h4>{{ image | replace: '-', ' ' | split: '.' | first | capitalize }}</h4>"
      >
        <img
          loading="lazy"
          class="gallery-thumbnail"
          alt="{{ image | split: '.' | first | replace: '-', ' ' | capitalize }}"
          src="{{ site.url }}{{ site.baseurl }}/assets/img/gallery/{{ include.picture_path }}/{{ base_name }}-400.{{ ext }}"
          srcset="
              {% for size in sizes %}
                {{ site.url }}{{ site.baseurl }}/assets/img/gallery/{{ include.picture_path }}/{{ base_name }}-{{ size }}.{{ ext }} {{ size }}w,
              {% endfor %}
            "
          sizes="(max-width: 576px) 95vw, (max-width: 992px) 45vw, 30vw"
        />
      </a>
    </div>
    {% endfor %}
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Initialize lightGallery with download button
    const galleryId = "gallery-{{ include.picture_path | slugify }}";
    lightGallery(document.getElementById(galleryId), {
      selector: ".gallery-link",
      download: true,
      actualSize: false,
      counter: true,
      getCaptionFromTitleOrAlt: true,
      addClass: "gallery-lightbox",
      plugins: [lgZoom, lgThumbnail, lgDownload],
      downloadExtraProps: {
        title: function (item) {
          return item.el.alt || "Download";
        },
      },
      downloadURL: function (item) {
        return item.el.dataset.downloadUrl || item.src;
      },
    });
  });
</script>
